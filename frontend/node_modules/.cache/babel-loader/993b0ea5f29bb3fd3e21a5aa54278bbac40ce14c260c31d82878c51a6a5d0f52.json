{"ast":null,"code":"var _jsxFileName = \"F:\\\\Intern years 2\\\\Food-Order\\\\Ordering-Foods\\\\frontend\\\\src\\\\contexts\\\\CartContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { apiService } from '../service/apiService';\nimport { AuthContext } from './AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CartContext = /*#__PURE__*/createContext();\nexport const CartProvider = ({\n  children\n}) => {\n  _s();\n  const [cartItems, setCartItems] = useState([]);\n  const [tableId, setTableId] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const {\n    user\n  } = useContext(AuthContext);\n\n  // Hàm load giỏ hàng và table từ backend\n  const loadCartFromDB = async userId => {\n    setIsLoading(true);\n    try {\n      const res = await apiService.getCart(userId);\n      setCartItems(res.items || []);\n      setTableId(res.table || null);\n      // Lưu tableId xuống localStorage để client nhớ\n      if (res.table) {\n        localStorage.setItem('tableId', res.table);\n      }\n    } catch (err) {\n      console.error('Không thể tải giỏ hàng:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  useEffect(() => {\n    // Lần đầu khi mount, lấy tableId từ localStorage\n    const storedTable = localStorage.getItem('tableId');\n    if (storedTable) {\n      setTableId(storedTable.startsWith(':') ? storedTable.slice(1) : storedTable);\n    }\n    // Khi có user, tải cart & table từ backend\n    if (user !== null && user !== void 0 && user._id) {\n      loadCartFromDB(user._id);\n    }\n  }, [user]);\n  const addToCart = async food => {\n    if (!(user !== null && user !== void 0 && user._id)) return alert('Bạn cần đăng nhập trước');\n    const id = food.id || food._id;\n    const existing = cartItems.find(item => item.id === id);\n    try {\n      await apiService.addToCart({\n        userId: user._id,\n        foodId: id,\n        quantity: 1\n      });\n      if (existing) {\n        setCartItems(prev => prev.map(item => item.id === id ? {\n          ...item,\n          quantity: item.quantity + 1\n        } : item));\n      } else {\n        setCartItems(prev => [...prev, {\n          ...food,\n          id,\n          quantity: 1\n        }]);\n      }\n    } catch (err) {\n      console.error('Không thể thêm vào giỏ hàng:', err);\n    }\n  };\n  const updateQuantity = async (foodId, newQuantity) => {\n    if (!(user !== null && user !== void 0 && user._id)) return;\n    if (newQuantity <= 0) return removeFromCart(foodId);\n    try {\n      await apiService.updateCart({\n        userId: user._id,\n        foodId,\n        quantity: newQuantity\n      });\n      setCartItems(prev => prev.map(item => item.id === foodId ? {\n        ...item,\n        quantity: newQuantity\n      } : item));\n    } catch (err) {\n      console.error('Không thể cập nhật giỏ hàng:', err);\n    }\n  };\n  const removeFromCart = async foodId => {\n    if (!(user !== null && user !== void 0 && user._id)) return;\n    try {\n      await apiService.removeFromCart({\n        userId: user._id,\n        foodId\n      });\n      setCartItems(prev => prev.filter(item => item.id !== foodId));\n    } catch (err) {\n      console.error('Không thể xoá khỏi giỏ hàng:', err);\n    }\n  };\n  const clearCart = async () => {\n    if (!(user !== null && user !== void 0 && user._id)) return;\n    try {\n      await apiService.clearCart(user._id);\n      setCartItems([]);\n      setTableId(null);\n      localStorage.removeItem('tableId');\n    } catch (err) {\n      console.error('Không thể xoá giỏ hàng:', err);\n    }\n  };\n  const getTotalPrice = () => cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);\n  const getTotalItems = () => cartItems.reduce((sum, item) => sum + item.quantity, 0);\n  return /*#__PURE__*/_jsxDEV(CartContext.Provider, {\n    value: {\n      cartItems,\n      addToCart,\n      removeFromCart,\n      updateQuantity,\n      clearCart,\n      getTotalPrice,\n      getTotalItems,\n      tableId,\n      setTableId,\n      isLoading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 125,\n    columnNumber: 5\n  }, this);\n};\n_s(CartProvider, \"cf6JMYqCgFZuFKFAUcjiE0cRCcA=\");\n_c = CartProvider;\nexport const useCart = () => {\n  _s2();\n  const context = useContext(CartContext);\n  if (!context) {\n    throw new Error('useCart must be used within a CartProvider');\n  }\n  return context;\n};\n_s2(useCart, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nvar _c;\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","apiService","AuthContext","jsxDEV","_jsxDEV","CartContext","CartProvider","children","_s","cartItems","setCartItems","tableId","setTableId","isLoading","setIsLoading","user","loadCartFromDB","userId","res","getCart","items","table","localStorage","setItem","err","console","error","storedTable","getItem","startsWith","slice","_id","addToCart","food","alert","id","existing","find","item","foodId","quantity","prev","map","updateQuantity","newQuantity","removeFromCart","updateCart","filter","clearCart","removeItem","getTotalPrice","reduce","sum","price","getTotalItems","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useCart","_s2","context","Error","$RefreshReg$"],"sources":["F:/Intern years 2/Food-Order/Ordering-Foods/frontend/src/contexts/CartContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { apiService } from '../service/apiService';\r\nimport { AuthContext } from './AuthContext';\r\n\r\nconst CartContext = createContext();\r\n\r\nexport const CartProvider = ({ children }) => {\r\n  const [cartItems, setCartItems] = useState([]);\r\n  const [tableId, setTableId] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { user } = useContext(AuthContext);\r\n\r\n  // Hàm load giỏ hàng và table từ backend\r\n  const loadCartFromDB = async (userId) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const res = await apiService.getCart(userId);\r\n      setCartItems(res.items || []);\r\n      setTableId(res.table || null);\r\n      // Lưu tableId xuống localStorage để client nhớ\r\n      if (res.table) {\r\n        localStorage.setItem('tableId', res.table);\r\n      }\r\n    } catch (err) {\r\n      console.error('Không thể tải giỏ hàng:', err);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Lần đầu khi mount, lấy tableId từ localStorage\r\n    const storedTable = localStorage.getItem('tableId');\r\n    if (storedTable) {\r\n      setTableId(storedTable.startsWith(':')\r\n        ? storedTable.slice(1)\r\n        : storedTable\r\n      );\r\n    }\r\n    // Khi có user, tải cart & table từ backend\r\n    if (user?._id) {\r\n      loadCartFromDB(user._id);\r\n    }\r\n  }, [user]);\r\n\r\n  const addToCart = async (food) => {\r\n    if (!user?._id) return alert('Bạn cần đăng nhập trước');\r\n\r\n    const id = food.id || food._id;\r\n    const existing = cartItems.find(item => item.id === id);\r\n\r\n    try {\r\n      await apiService.addToCart({\r\n        userId: user._id,\r\n        foodId: id,\r\n        quantity: 1,\r\n      });\r\n\r\n      if (existing) {\r\n        setCartItems(prev =>\r\n          prev.map(item =>\r\n            item.id === id ? { ...item, quantity: item.quantity + 1 } : item\r\n          )\r\n        );\r\n      } else {\r\n        setCartItems(prev => [...prev, { ...food, id, quantity: 1 }]);\r\n      }\r\n    } catch (err) {\r\n      console.error('Không thể thêm vào giỏ hàng:', err);\r\n    }\r\n  };\r\n\r\n  const updateQuantity = async (foodId, newQuantity) => {\r\n    if (!user?._id) return;\r\n\r\n    if (newQuantity <= 0) return removeFromCart(foodId);\r\n\r\n    try {\r\n      await apiService.updateCart({\r\n        userId: user._id,\r\n        foodId,\r\n        quantity: newQuantity,\r\n      });\r\n\r\n      setCartItems(prev =>\r\n        prev.map(item =>\r\n          item.id === foodId ? { ...item, quantity: newQuantity } : item\r\n        )\r\n      );\r\n    } catch (err) {\r\n      console.error('Không thể cập nhật giỏ hàng:', err);\r\n    }\r\n  };\r\n\r\n  const removeFromCart = async (foodId) => {\r\n    if (!user?._id) return;\r\n\r\n    try {\r\n      await apiService.removeFromCart({ userId: user._id, foodId });\r\n      setCartItems(prev => prev.filter(item => item.id !== foodId));\r\n    } catch (err) {\r\n      console.error('Không thể xoá khỏi giỏ hàng:', err);\r\n    }\r\n  };\r\n\r\n  const clearCart = async () => {\r\n    if (!user?._id) return;\r\n    try {\r\n      await apiService.clearCart(user._id);\r\n      setCartItems([]);\r\n      setTableId(null);\r\n      localStorage.removeItem('tableId');\r\n    } catch (err) {\r\n      console.error('Không thể xoá giỏ hàng:', err);\r\n    }\r\n  };\r\n\r\n  const getTotalPrice = () =>\r\n    cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);\r\n\r\n  const getTotalItems = () =>\r\n    cartItems.reduce((sum, item) => sum + item.quantity, 0);\r\n\r\n  return (\r\n    <CartContext.Provider\r\n      value={{\r\n        cartItems,\r\n        addToCart,\r\n        removeFromCart,\r\n        updateQuantity,\r\n        clearCart,\r\n        getTotalPrice,\r\n        getTotalItems,\r\n        tableId,\r\n        setTableId,\r\n        isLoading,\r\n      }}\r\n    >\r\n      {children}\r\n    </CartContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useCart = () => {\r\n  const context = useContext(CartContext);\r\n  if (!context) {\r\n    throw new Error('useCart must be used within a CartProvider');\r\n  }\r\n  return context;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}